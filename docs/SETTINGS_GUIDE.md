# 🛠️ 系统设置指南

## 概述

本系统提供了强大的参数配置功能，允许用户通过美化的菜单界面调整所有关键参数，配置会自动保存到JSON文件中，实现持久化存储。

## 🚀 快速开始

1. **启动主程序**：
   ```bash
   python main_menu.py
   ```

2. **进入设置界面**：
   - 在主菜单中选择 `5. ⚙️ 系统设置`

3. **配置参数**：
   - 选择操作类型（查看、编辑、重置等）
   - 按分类或单个参数进行配置

## 📋 可配置参数详览

### 🔧 基础设置 (basic)
- **网站地址** (`base_url`): 目标网站URL
- **默认密码** (`default_password`): 登录默认密码
- **最大线程数** (`max_workers`): 并发处理线程数 (1-20)

### 🌐 浏览器设置 (browser)
- **无头模式** (`headless_mode`): 是否后台运行浏览器
- **窗口宽度** (`browser_width`): 浏览器窗口宽度 (200-800px)
- **窗口高度** (`browser_height`): 浏览器窗口高度 (200-800px)
- **窗口列数** (`window_cols`): 窗口排列列数 (1-6)
- **窗口行数** (`window_rows`): 窗口排列行数 (1-4)

### ⏱️ 时间设置 (timing)
- **登录等待时间** (`login_wait_time`): 登录超时时间 (5-30秒)
- **上传等待时间** (`upload_wait_time`): 文件上传间隔 (1-10秒)
- **提交等待时间** (`submit_wait_time`): 提交确认等待 (2-15秒)
- **状态检查等待时间** (`status_check_wait_time`): 状态检查间隔 (1-10秒)

### 🖼️ 图片设置 (image)
- **输出目录** (`output_dir`): 图片保存目录名
- **图片质量** (`image_quality`): PNG图片质量 (50-100)
- **每人最大图片数** (`max_images_per_student`): 生成数量限制 (1-20)
- **大字体大小** (`font_size_large`): 标题字体大小 (20-60)
- **中字体大小** (`font_size_medium`): 正文字体大小 (16-40)
- **小字体大小** (`font_size_small`): 辅助字体大小 (12-30)

### 📁 文件设置 (file)
- **支持的图片格式** (`supported_image_extensions`): 可选多个格式

## 🎛️ 设置操作

### 1. 📋 查看所有设置
显示当前所有参数的值和描述

### 2. 🎯 按分类编辑设置
- 选择设置分类
- 浏览该分类下的所有参数
- 逐一编辑参数值

### 3. ✏️ 编辑单个参数
快速编辑模式，支持：
- 格式：`分类.参数名 = 新值`
- 示例：`basic.max_workers = 8`
- 输入 `list` 查看所有可用参数

### 4. 🔧 重置为默认设置
- 清除所有自定义配置
- 恢复出厂设置
- 需输入 `YES` 确认

### 5. 💾 备份当前设置
- 创建配置文件备份
- 支持自定义备份文件名
- 默认备份到 `user_settings.json.backup`

### 6. 🔄 恢复备份设置
- 从备份文件恢复配置
- 支持指定备份文件名
- 自动验证备份文件完整性

### 7. 📄 查看配置文件信息
显示配置文件详细信息：
- 文件路径和大小
- 最后修改时间
- 参数统计信息
- 备份文件状态

## 💡 使用技巧

### 参数验证
- 系统会自动验证参数类型和范围
- 无效输入会被拒绝并显示错误信息
- 所有更改实时生效

### 🔐 关键参数二次确认
系统会对以下关键参数要求二次确认：
- **🌐 网站地址** - 影响所有登录和上传功能
- **🔑 默认密码** - 影响所有学生的自动登录
- **⚡ 最大线程数** - 影响系统性能和稳定性
- **👻 无头模式** - 改变浏览器显示方式
- **🕐 登录等待时间** - 影响登录成功率
- **📁 输出目录** - 影响图片保存位置

修改关键参数时系统会：
1. 显示警告信息和影响说明
2. 显示当前值和新值对比
3. 要求明确确认（输入'YES'或确认对话框）
4. 修改成功后提示备份建议

### 布尔值输入
支持多种格式：
- `true`/`false`
- `1`/`0`
- `yes`/`no`
- `是`/`否`

### 列表参数
支持逗号分隔的多值输入：
- 示例：`*.jpg, *.png, *.gif`

### 快速重载
修改配置后，系统会自动重新加载设置，无需重启程序。

## 🔧 配置文件结构

配置以JSON格式存储在 `user_settings.json` 中：

```json
{
  "basic": {
    "base_url": {
      "value": "http://120.55.57.58:3510/",
      "description": "网站地址",
      "type": "string"
    }
  }
}
```

### 手动编辑
虽然推荐使用菜单界面，但也可以直接编辑JSON文件：
1. 关闭程序
2. 编辑 `user_settings.json`
3. 重启程序

## ⚠️ 注意事项

### 参数范围
- 线程数不应超过CPU核心数的2倍
- 时间设置过短可能导致操作失败
- 窗口尺寸需适配屏幕分辨率

### 无头模式
- 启用无头模式可提高性能
- 调试时建议禁用无头模式
- 某些网站可能检测无头模式

### 备份建议
- 重要配置前建议先备份
- 定期清理过期备份文件
- 配置文件损坏时可从备份恢复

## 🐛 故障排除

### 配置文件损坏
```bash
# 删除损坏的配置文件，系统会重新创建默认配置
rm user_settings.json
python main_menu.py
```

### 设置不生效
1. 检查参数是否在有效范围内
2. 确认配置文件权限正常
3. 尝试重置为默认设置

### 界面显示异常
1. 确保终端支持UTF-8编码
2. 调整终端窗口大小
3. 检查字体设置

## 📞 技术支持

如遇到问题，请：
1. 运行 `python optimization_test.py` 检查系统状态
2. 查看错误日志信息
3. 尝试重置配置为默认值

---

*最后更新：2025年9月* 