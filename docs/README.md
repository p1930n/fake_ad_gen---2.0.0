# 批量学生文件上传程序 (改进版)

这是一个改进的批量文件上传程序，用于自动化处理学生文件上传到指定网站。

## 主要改进

### ✨ 新功能
- **模块化设计**: 代码拆分为多个专业模块，易于维护和扩展
- **智能异常处理**: 具体的异常类型和详细错误信息
- **实时进度显示**: 美观的进度条和实时状态反馈
- **自动线程优化**: 根据CPU核心数自动调整线程数
- **资源管理**: 使用上下文管理器确保浏览器资源正确释放
- **命令行参数**: 支持自定义线程数和Excel文件路径
- **详细报告**: 生成Excel格式的处理报告，包含失败原因统计

### 🔧 技术改进
- **更好的错误处理**: 捕获具体异常而非空catch块
- **线程安全**: 使用锁机制保证数据一致性
- **性能优化**: 浏览器选项优化，减少资源占用
- **用户体验**: 丰富的emoji提示和彩色输出

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本使用
```bash
python main_improved.py
```

### 高级选项
```bash
# 指定线程数
python main_improved.py --workers 8

# 指定Excel文件
python main_improved.py --excel-file "学生信息.xlsx"

# 显示详细输出
python main_improved.py --verbose

# 组合使用
python main_improved.py -w 6 -e "class_info.xlsx" -v
```

## 文件结构

```
fake_ad_generator/
├── main_improved.py          # 主程序 (改进版)
├── parallel.py              # 原始程序 (保留)
├── config.py                # 配置管理
├── exceptions.py            # 自定义异常
├── browser_manager.py       # 浏览器管理
├── website_handler.py       # 网站操作处理
├── file_manager.py          # 文件管理
├── progress_tracker.py      # 进度跟踪
├── student_processor.py     # 学生处理逻辑
├── report_generator.py      # 报告生成
├── requirements.txt         # 依赖文件
├── class_info.xlsx         # 学生信息文件
└── README.md               # 使用说明
```

## 配置说明

### 线程配置
- **默认线程数**: CPU核心数 × 2 (最大12)
- **线程范围**: 1-20
- **自动调整**: 超出范围会自动调整到合理值

### 窗口布局
- **屏幕分辨率**: 2560×1440 (2K)
- **浏览器窗口**: 350×400
- **布局**: 4列×3行 (最多12个并发窗口)

### 等待时间 (保持固定)
- **登录等待**: 10秒
- **上传等待**: 2秒
- **提交等待**: 5秒
- **状态检查**: 2秒

## Excel文件格式

Excel文件必须包含以下列：
- **姓名**: 学生姓名
- **学号**: 学生学号 (用于登录)

## 输出说明

### 进度显示
程序运行时会显示：
- 实时进度条
- 已完成/待审核/新提交/失败统计
- 预计剩余时间
- 详细的处理日志

### 处理报告
程序完成后会生成：
- Excel格式的详细报告 (`处理报告_YYYYMMDD_HHMMSS.xlsx`)
- 包含4个工作表：已完成、待审核、新提交、提交失败
- 失败原因统计
- 成功率计算

## 错误处理

程序会捕获并处理以下错误：
- **登录失败**: 账号密码错误、网络问题
- **文件问题**: Excel文件格式错误、学生文件夹未找到、图片文件缺失
- **上传错误**: 网页元素未找到、上传超时
- **状态检查**: 页面加载失败、状态识别错误

## 注意事项

1. **Chrome浏览器**: 需要安装Chrome浏览器和对应的ChromeDriver
2. **网络连接**: 确保网络连接稳定
3. **文件路径**: 学生文件夹名称应包含学生姓名
4. **图片格式**: 支持 jpg、jpeg、png 格式
5. **中断处理**: 可以使用Ctrl+C安全中断程序

## 故障排除

### 常见问题
1. **ChromeDriver版本不匹配**: 更新ChromeDriver到与Chrome浏览器匹配的版本
2. **权限问题**: 确保程序有读写文件的权限
3. **网络超时**: 检查网络连接，必要时增加等待时间
4. **内存不足**: 减少线程数 (`--workers` 参数)

### 性能调优
- **CPU密集**: 减少线程数
- **网络慢**: 减少并发数
- **内存不足**: 使用较少的线程
- **磁盘IO慢**: 确保有足够的磁盘空间

## 与原版对比

| 功能 | 原版 (parallel.py) | 改进版 (main_improved.py) |
|------|-------------------|---------------------------|
| 异常处理 | 空catch块 | 具体异常类型 |
| 进度显示 | 简单print | 美观进度条 |
| 线程管理 | 固定数量 | 自动优化 |
| 资源管理 | 手动清理 | 上下文管理器 |
| 模块化 | 单文件 | 多模块设计 |
| 配置管理 | 硬编码 | 配置类管理 |
| 报告生成 | 基础Excel | 详细分析报告 |
| 用户体验 | 基本输出 | 丰富反馈 | 
